"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2724],{71575:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t={key:"v-320f59bd",path:"/httpUtils/%E7%88%AC%E8%99%AB%E4%BD%BF%E7%94%A8.html",title:"进行导包",lang:"en-US",frontmatter:{date:"2021/3/12"},excerpt:"",headers:[{level:2,title:"webClient.getOptions().setThrowExceptionOnScriptError(false);",slug:"webclient-getoptions-setthrowexceptiononscripterror-false",children:[]}],git:{updatedTime:1654857597e3,contributors:[{name:"qsyyke",email:"2291308094@qq.com",commits:1}]}}},29522:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const t=(0,a(66252).uE)('<h1 id="进行导包" tabindex="-1"><a class="header-anchor" href="#进行导包" aria-hidden="true">#</a> 进行导包</h1><p>使用此包的时候，pom为</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;dependency&gt;\n    &lt;groupId&gt;net.sourceforge.htmlunit&lt;/groupId&gt;\n    &lt;artifactId&gt;htmlunit&lt;/artifactId&gt;\n    &lt;version&gt;2.47.1&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;\n    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;\n    &lt;version&gt;4.5.12&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpcore --&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;\n    &lt;artifactId&gt;httpcore&lt;/artifactId&gt;\n    &lt;version&gt;4.4.14&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>将这三个导入就可以，其实只需要导入<code>net.sourceforge.htmlunit</code>就可以，但是另外两个只是为了操作方便</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.httpcomponents<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>httpcore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>出现这个问题的原因</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NoClassDefFoundError</span><span class="token operator">:</span> org<span class="token operator">/</span>apache<span class="token operator">/</span>http<span class="token operator">/</span>config<span class="token operator">/</span><span class="token class-name">Lookup</span>\n\n\tat <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit<span class="token punctuation">.</span></span>WebClient</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">289</span><span class="token punctuation">)</span>\n\tat <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit<span class="token punctuation">.</span></span>WebClient</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">265</span><span class="token punctuation">)</span>\n\tat <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit<span class="token punctuation">.</span></span>WebClient</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">255</span><span class="token punctuation">)</span>\n\tat <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit<span class="token punctuation">.</span></span>WebClient</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">247</span><span class="token punctuation">)</span>\n\tat com<span class="token punctuation">.</span>yq<span class="token punctuation">.</span>web<span class="token punctuation">.</span>jsoup<span class="token punctuation">.</span>test2<span class="token punctuation">.</span><span class="token function">test2</span><span class="token punctuation">(</span>test2<span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">)</span>\n\tat java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">jdk<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>出现这个问题，网上很多说的是，因为版本低，将</p><h1 id="总要设置" tabindex="-1"><a class="header-anchor" href="#总要设置" aria-hidden="true">#</a> 总要设置</h1><h2 id="webclient-getoptions-setthrowexceptiononscripterror-false" tabindex="-1"><a class="header-anchor" href="#webclient-getoptions-setthrowexceptiononscripterror-false" aria-hidden="true">#</a> webClient.getOptions().setThrowExceptionOnScriptError(false);</h2><p>因为这个工具是作为一个浏览器，但是在真正的浏览器上执行有错的JavaScript代码的时候，程序会继续往下执行，但是在client中，就会停止，设置这个参数为false，那么遇到错误，就会使程序停止</p><h1 id="ajax使用" tabindex="-1"><a class="header-anchor" href="#ajax使用" aria-hidden="true">#</a> ajax使用</h1><p>如果目标网址是一个使用ajax进行获取的数据，那么想要获取此数据，需要使程序休眠几秒，因为使用ajax发送请求也是需要一定的时间</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">WebClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebClient</span><span class="token punctuation">(</span><span class="token class-name">BrowserVersion</span><span class="token punctuation">.</span>CHROME<span class="token punctuation">)</span><span class="token punctuation">;</span>\nclient<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setJavaScriptEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//很重要，启用JS</span>\n<span class="token class-name">HtmlPage</span> page <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/jsoupajax.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果直接使用下面这个程序，除了title，其他的时间不够，不能获取到</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">WebClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebClient</span><span class="token punctuation">(</span><span class="token class-name">BrowserVersion</span><span class="token punctuation">.</span>CHROME<span class="token punctuation">)</span><span class="token punctuation">;</span>\nclient<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setJavaScriptEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//很重要，启用JS</span>\n<span class="token class-name">HtmlPage</span> page <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/jsoupajax.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>同样也可以使用下面的这种方式(推荐)</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">WebClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//不能放在client.getPage()代码的上面</span>\n<span class="token class-name">HtmlPage</span> page <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/jsoupajax.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//client.waitForBackgroundJavaScript(10000);</span>\n<span class="token comment">//client.waitForBackgroundJavaScriptStartingBefore(10000);</span>\n<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注释部分任选一个，都可以实现</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n    &lt;script src=&quot;./js/need/jquery-3.5.1.min.js&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;div&gt;&lt;/div&gt;\n&lt;script&gt;\n    $(function () {\n        $.get(&quot;/yq_json&quot;,function (data) {\n            document.querySelector(&quot;div&quot;).innerText = data;\n        });\n    })\n&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h1 id="输出不是文本" tabindex="-1"><a class="header-anchor" href="#输出不是文本" aria-hidden="true">#</a> 输出不是文本</h1><p>对于像这种，</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;输出&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>不能够使用<code>HtmlPage page = webClient.getPage(&quot;http://localhost/ServletClientTest1&quot;);</code>获取，因为返回的，并不是一个HTML页面，而是一个text的文本，所以需要使用进行获取</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">TextPage</span> page <span class="token operator">=</span> webClient<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost/ServletClientTest1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">Document</span> parse <span class="token operator">=</span> <span class="token class-name">Jsoup</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parse<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>response.setContentType(&quot;text/html;charset=utf-8&quot;);</code>如果是这样设置的，那么也就不能使用<code>TextPage</code>进行获取，需要使用html</p><p>nz其他专业名词 javaweb</p><p>vn名动词</p>',28),p={},e=(0,a(83744).Z)(p,[["render",function(n,s){return t}]])}}]);